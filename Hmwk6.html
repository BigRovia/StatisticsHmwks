<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Online Mean, Variance & Std Calculator</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #f5f7fa;
      padding: 25px;
      color: #222;
    }
    h2 { margin-bottom: 10px; }
    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 620px;
    }
    input {
      width: 120px;
      padding: 6px;
      border-radius: 5px;
      border: 1px solid #bbb;
      font-size: 14px;
    }
    button {
      padding: 8px 14px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      transition: 0.15s;
      white-space: nowrap;
    }
    button:hover { opacity: 0.85; }
    .btn-main { background: #1976d2; color: white; }
    .btn-rand { background: #388e3c; color: white; }
    .btn-reset { background: #d32f2f; color: white; }
    .stat { font-size: 1.05em; margin: 3px 0; }
    #toggleList {
      color: #1976d2;
      cursor: pointer;
      text-decoration: underline;
      margin-top: 10px;
      font-size: 14px;
    }
    #numbersBox {
      margin-top: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      background: #fafafa;
      border-radius: 6px;
      display: none;
      max-height: 160px;
      overflow-y: auto;
      font-size: 14px;
    }
    .numitem {
      display: inline-block;
      padding: 3px 6px;
      margin: 2px;
      background: #e0e7ff;
      border-radius: 4px;
      font-family: monospace;
    }
  </style>
</head>
<body>

<div class="card">
  <h2>Online Mean, Variance & Std Calculator</h2>

  <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; margin-bottom: 14px;">
    <label>Insert a number:</label>
    <input type="number" id="numInput" min="-1000" max="1000" step="0.01">

    <button class="btn-main" onclick="addManual()">Add</button>
    <button class="btn-rand" onclick="addRandom()">Add Random</button>
    <button class="btn-reset" onclick="resetAll()">Reset</button>
  </div>

  <h3 style="margin-top:10px;">Current Statistics</h3>
  <p class="stat">Count (n): <b><span id="statN">0</span></b></p>
  <p class="stat">Mean: <b><span id="statMean">0.00</span></b></p>
  <p class="stat">Population Variance: <b><span id="statVarPop">0.00</span></b></p>
  <p class="stat">Sample Variance: <b><span id="statVarSample">0.00</span></b></p>
  <p class="stat">Population Std Dev: <b><span id="statStdPop">0.00</span></b></p>
  <p class="stat">Sample Std Dev: <b><span id="statStdSample">0.00</span></b></p>

  <p id="toggleList" onclick="toggleNumbers()">Show / Hide inserted values</p>
  <div id="numbersBox"></div>
</div>

<script>
let n = 0;
let mean = 0;
let M2 = 0;
let numbers = [];

function onlineVarianceUpdate(newValue) {
  n++;
  const delta = newValue - mean;
  mean += delta / n;
  const delta2 = newValue - mean;
  M2 += delta * delta2;
  return M2 / n; // population variance
}

function addManual() {
  let val = document.getElementById('numInput').value.trim();

  if (val === "") {
    alert("Please enter a number.");
    return;
  }

  let num = parseFloat(val);
  if (Number.isNaN(num)) {
    alert("Invalid number.");
    return;
  }

  if (num < -1000 || num > 1000) {
    alert("Value out of range (-1000 to 1000). It will be clamped.");
    num = Math.max(-1000, Math.min(1000, num));
  }

  num = parseFloat(num.toFixed(2));
  document.getElementById('numInput').value = num.toFixed(2);

  processValue(num);
}

function addRandom() {
  let val = Math.random() * 2000 - 1000;
  val = parseFloat(val.toFixed(2));
  processValue(val);
}

function processValue(v) {
  v = Math.max(-1000, Math.min(1000, parseFloat(v.toFixed(2))));
  numbers.push(v);
  const popVar = onlineVarianceUpdate(v);
  updateDisplay(popVar);
}

function updateDisplay(popVar) {
  document.getElementById("statN").textContent = n;
  document.getElementById("statMean").textContent = mean.toFixed(2);

  const sampleVar = n > 1 ? M2 / (n - 1) : 0;

  document.getElementById("statVarPop").textContent = popVar.toFixed(2);
  document.getElementById("statVarSample").textContent = sampleVar.toFixed(2);

  const popStd = Math.sqrt(popVar);
  const sampleStd = n > 1 ? Math.sqrt(sampleVar) : 0;

  document.getElementById("statStdPop").textContent = popStd.toFixed(2);
  document.getElementById("statStdSample").textContent = sampleStd.toFixed(2);

  displayNumbers();
}

function displayNumbers() {
  const box = document.getElementById("numbersBox");
  box.innerHTML = numbers.map(v =>
    `<span class="numitem">${v.toFixed(2)}</span>`
  ).join("");
}

function resetAll() {
  n = 0; mean = 0; M2 = 0; numbers = [];
  document.getElementById("statN").textContent = "0";
  document.getElementById("statMean").textContent = "0.00";
  document.getElementById("statVarPop").textContent = "0.00";
  document.getElementById("statVarSample").textContent = "0.00";
  document.getElementById("statStdPop").textContent = "0.00";
  document.getElementById("statStdSample").textContent = "0.00";
  document.getElementById("numbersBox").innerHTML = "";
  document.getElementById("numInput").value = ""; // clears field
}

function toggleNumbers() {
  const box = document.getElementById("numbersBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
}
</script>
</body>
</html>